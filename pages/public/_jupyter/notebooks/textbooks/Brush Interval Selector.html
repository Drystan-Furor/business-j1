  <div class="cell text_cell">
    <button class="js-nbinteract-widget">
      Loading widgets...
    </button>
  </div>



<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Linking-Plots-Using-Brush-Interval-Selector">Linking Plots Using Brush Interval Selector<a class="anchor-link" href="#Linking-Plots-Using-Brush-Interval-Selector">&#182;</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Details on how to use the brush interval selector can be found in <a href="../Interactions/Selectors.ipynb#brushselectors">this</a> notebook.</p>
<p>Brush interval selectors can be used where <em>continuous updates</em> are <strong>not</strong> desirable (for example, in callbacks performing slower computations)</p>
<p>The boolean trait <code>brushing</code> can be used to control <em>continuous updates</em> in the <code>BrushSelector</code>. <code>brushing</code> will be set to <code>False</code> when the interval selector is not brushing. We can register callbacks by listening to the <code>brushing</code> trait of the brush selector. We can check the value of <code>brushing</code> trait in the callback and perform updates <em>only</em> at the end of brushing.</p>
<p>Let's now look at an example of linking a time series plot to a scatter plot using a <code>BrushIntervalSelector</code></p>

</div>
</div>
</div>

  

  <div class="
      cell border-box-sizing code_cell rendered">
    <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>

    </div>
</div>
</div>

  </div>

  

  <div class="
      cell border-box-sizing code_cell rendered">
    <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">Layout</span><span class="p">,</span> <span class="n">HTML</span><span class="p">,</span> <span class="n">VBox</span>
<span class="kn">import</span> <span class="nn">bqplot.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>

    </div>
</div>
</div>

  </div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's set up an interval selector on a figure containing two time series plots. The interval selector can be activated by clicking on the figure</p>

</div>
</div>
</div>

  

  <div class="
      cell border-box-sizing code_cell rendered">
    <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">bqplot.interacts</span> <span class="kn">import</span> <span class="n">BrushIntervalSelector</span>

<span class="n">y1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># two simple random walks</span>

<span class="n">fig_layout</span> <span class="o">=</span> <span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s2">&quot;900px&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="s2">&quot;500px&quot;</span><span class="p">)</span>
<span class="n">time_series_fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="n">fig_layout</span><span class="p">)</span>
<span class="n">line</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">])</span>

<span class="c1"># create a fast interval selector by passing in the X scale and the line mark on which the selector operates</span>
<span class="n">intsel</span> <span class="o">=</span> <span class="n">BrushIntervalSelector</span><span class="p">(</span><span class="n">marks</span><span class="o">=</span><span class="p">[</span><span class="n">line</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">scales</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">])</span>
<span class="n">time_series_fig</span><span class="o">.</span><span class="n">interaction</span> <span class="o">=</span> <span class="n">intsel</span>  <span class="c1"># set the interval selector on the figure</span>
</pre></div>

    </div>
</div>
</div>

  </div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's now create a scatter plot of the two time series and stack it below the time series plot using a <code>VBox</code></p>

</div>
</div>
</div>

  

  <div class="
      cell border-box-sizing code_cell rendered">
    <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">scat_fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span>
    <span class="n">layout</span><span class="o">=</span><span class="n">fig_layout</span><span class="p">,</span>
    <span class="n">animation_duration</span><span class="o">=</span><span class="mi">750</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Scatter of time series slice selected by the interval selector&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># set the x and y attributes to the y values of line.y</span>
<span class="n">scat</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="n">line</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;red&quot;</span><span class="p">],</span> <span class="n">stroke</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

  </div>

  

  <div class="
      cell border-box-sizing code_cell rendered">
    <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># define a callback for the interval selector</span>
<span class="k">def</span> <span class="nf">update_scatter</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="n">brushing</span> <span class="o">=</span> <span class="n">intsel</span><span class="o">.</span><span class="n">brushing</span>

    <span class="c1"># update scatter *only* when the interval selector</span>
    <span class="c1"># is not brushing to prevent continuous updates</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">brushing</span><span class="p">:</span>
        <span class="c1"># interval selector is active</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">selected</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># get the start and end indices of the interval</span>
            <span class="n">start_ix</span><span class="p">,</span> <span class="n">end_ix</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">selected</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">line</span><span class="o">.</span><span class="n">selected</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># interval selector is *not* active</span>
            <span class="n">start_ix</span><span class="p">,</span> <span class="n">end_ix</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>

        <span class="c1"># update the x and y attributes of the scatter by slicing line.y</span>
        <span class="k">with</span> <span class="n">scat</span><span class="o">.</span><span class="n">hold_sync</span><span class="p">():</span>
            <span class="n">scat</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">scat</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">y</span><span class="p">[:,</span> <span class="n">start_ix</span><span class="p">:</span><span class="n">end_ix</span><span class="p">]</span>


<span class="c1"># register the callback with brushing trait of interval selector</span>
<span class="n">intsel</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">update_scatter</span><span class="p">,</span> <span class="s2">&quot;brushing&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

  </div>

  

  <div class="
      cell border-box-sizing code_cell rendered">
    <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">help_label</span> <span class="o">=</span> <span class="n">HTML</span><span class="p">(</span>
    <span class="s1">&#39;&lt;div style=&quot;color: blue; font-size: 16px; margin:20px 0px 0px 50px&quot;&gt;</span><span class="se">\</span>
<span class="s1">                  Brush on the time series plot to activate the interval selector&lt;/div&gt;&#39;</span>
<span class="p">)</span>
<span class="n">VBox</span><span class="p">([</span><span class="n">help_label</span><span class="p">,</span> <span class="n">time_series_fig</span><span class="p">,</span> <span class="n">scat_fig</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

  </div>

